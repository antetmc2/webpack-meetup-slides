export { swiss as theme } from 'mdx-deck/themes'

import { Appear } from 'mdx-deck'
import { CodeSurfer } from "mdx-deck-code-surfer"
import Code from 'mdx-code';

# Introduction to Packing and Building Apps with Webpack 4
### Ante Tomic, .NET Software Engineer (Infobip)
---

# How did everything start?
<Appear>
  <div style={{
    float: 'left',
    left: 0,
    width: '50%',
  }}>
    <img src="first-web.png" style={{
      width: '38vw',
      height: '35vh'
    }}/>
  </div>
  <div style={{
      float: 'left',
      width: '50%',
  }}>
    <img src="funny-website.jpg" style={{
      width: '38vw',
      height: '35vh'
    }}/>
  </div>
  <div style={{
      float: 'left',
      width: '50%',
  }}>
    <img src="modern-web.png" style={{
      width: '38vw',
      height: '37vh'
    }}/>
  </div>
</Appear>

---

import { Image } from 'mdx-deck'

# Today's issues?

<img src="today-issues.png" style={{
  width: '56vw'
}}/>

---

# Webpack (2012 - ...)

<div style={{
  textAlign: 'center'
}}>
  <img src="webpack-bundling.png" style={{
    width: '53vw'
  }}/>
</div>

<div style={{
  width: '100%'
}}>
  <span style={{
    fontSize: '4.2vmin',
    color: '#a5a5a5'
  }}>
    Tobias Koppers, Sean Larkin, Johannes Ewald, Juho Vepsäläinen, Kees Kluskens and Webpack contributors
  </span>
</div>

---

# Sample project

* Node.JS
* Folder of any name

```
npm init -y
```

---

# Starting with project

```
npm i webpack webpack-cli -D
```
* What else?

<Appear>
  <div
    style={{
      textAlign: 'center'
    }}
  >
    <img src="nothing-to-do-here.png" style={{
      width: '24vw'
    }}/>
  </div>
</Appear>

---

<CodeSurfer
  title="html-webpack-plugin"
  code={require("!raw-loader!./webpack-snippets/01-html.js")}
  showNumbers
  steps={[
    { notes: 'Adding the html-webpack-plugin' },
    { lines: [1], notes: 'Before this: npm i -D html-webpack-plugin!' },
    { lines: [4, 8], notes: 'All plugins we use go under plugins' },
    { range: [5, 7], notes: 'Defining the html-webpack-plugin' },
  ]}
/>

---

# webpack-dev-server

```
npm i webpack-dev-server -D
```

And then update _package.json_:

```
  "scripts": {
    "start": "webpack-dev-server --mode development",
    "build": "webpack --mode production"
  },
```

---

<CodeSurfer
  title="Or we can modify webpack-dev-server a little bit :)"
  code={require("!raw-loader!./webpack-snippets/02-webpack-dev-server.js")}
  showNumbers
    steps={[
    { notes: 'We are returning to webpack.config.js ...' },
    { range: [9, 14], notes: 'Adding the devServer property' },
    { lines: [10], notes: 'Which errors we want to see!' },
    { lines: [11, 12], notes: 'Host/Port values from process.env (or defaults if not defined)' },
    { lines: [13], notes: 'Opening our application in browser on application start ...' },
  ]}
/>

---

# Compiling modern JavaScript
* Babel
```
npm i @babel/core babel-loader @babel/preset-env -D
```
* Let's modify Webpack configuration

---

<CodeSurfer
  title="And now let's add Babel!"
  code={require("!raw-loader!./webpack-snippets/03-adding-babel.js")}
  showNumbers
    steps={[
    { notes: 'We are returning to webpack.config.js ...' },
    { lines: [2], notes: 'Defining necessary imports' },
    { lines: [5, 6, 19, 20], notes: 'Adding module property inside which we are defining rules for compiling the files' },
    { range: [7, 18], notes: 'Telling Webpack how to compile JavaScript' },
    { lines: [8], notes: 'Regex to regcognize which files to compile' },
    { lines: [9], notes: 'Optimizing build by including/excluding only specific folders' },
    { range: [10, 17], notes: 'Defining used loaders' },
    { lines: [11], notes: 'Which loader?' },
    { range: [12, 16], notes: 'Defining loader options (here we are making compiling newer JavaScript possible)' },
  ]}
/>

---

<CodeSurfer
  title="What about IE11, etc.? Polyfills!"
  code={require("!raw-loader!./webpack-snippets/04-adding-polyfills.js")}
  showNumbers
    steps={[
    { notes: 'First install core-js: npm i -D core-js' },
    { notes: 'Now we are returning to webpack.config.js ...' },
    { range: [13, 18], notes: 'Changing @babel/preset-env' },
    { range: [14, 16], notes: 'Using browserslist to define which browsers should be supported' },
    { lines: [17], notes: 'Telling Webpack to automatically include only polyfills necessary for opening a page' },
  ]}
/>

---

<CodeSurfer
  title="Adding styles"
  code={require("!raw-loader!./webpack-snippets/05-css-and-styles.js")}
  showNumbers
    steps={[
    { notes: 'Again back to webpack.config.js ...' },
    { range: [20, 24], notes: 'Adding new rule under module -> rules' },
    { lines: [21, 22], notes: 'Usual ... :)' },
    { lines: [23], notes: 'Now this is new, 2 loaders!' },
    { tokens: { 23: [6, 7, 8] }, notes: "First we take code and make it readable with css-loader ..." },
    { tokens: { 23: [3, 4, 5] }, notes: "Then we take transpiled code and turn it into HTML's style tag!" },
    { lines: [23], notes: 'This basically means style(css(CODE)), like LIFO!' },
  ]}
/>

---

<CodeSurfer
  title="Extracting and optimizing CSS"
  code={require("!raw-loader!./webpack-snippets/06-extracting-css.js")}
  showNumbers
    steps={[
    { notes: 'Again back to webpack.config.js ...' },
    { lines: [23, 24, 25, 33, 34, 35], notes: 'Let\'s modify extracting first!' },
    { lines: [2], notes: 'Adding the dependency first ...' },
    { lines: [25], notes: 'And mini-css-extract-plugin\'s loader instead of style-loader' },
    { lines: [33, 34, 35], notes: 'And then we are adding new plugin where we can define options (we need only filename)' },
    { lines: [3], notes: 'Now let\'s optimize CSS! Adding the dependency first again ...' },
    { lines: [37, 40], notes: 'And now adding new property: optimization!' },
    { lines: [38, 40], notes: 'Since we are minimizing files, we need minimizer property ...' },
    { range: [37, 41], notes: 'And we only need to tell Webpack to optimize files!' },
  ]}
/>

---

<CodeSurfer
  title="Loading files"
  code={require("!raw-loader!./webpack-snippets/07-loading-files.js")}
  showNumbers
    steps={[
    { notes: 'Again back to webpack.config.js ...' },
    { range: [27, 38], notes: 'We are adding the new rule for images!' },
    { lines: [28, 29], notes: 'This is already quite usual' },
    { lines: [31], notes: 'We are using url-loader to load images, bue let\'s check why!' },
    { range: [32, 36], notes: 'As usual, we are passing the list of options' },
    { lines: [33], notes: 'File < 10000 bytes ? url-loader : fallback loader (default: file-loader)' },
    { lines: [45, 46, 47], notes: 'First, let\'s remember that CSS is saved in folder, not in root like JS!' },
    { lines: [34], notes: 'In this case, we assume that our project will have images in CSS, ' },
    { lines: [34], notes: 'So we define public path which will be appended before our file' },
    { lines: [35], notes: 'And at the end we assign desired name ... :)' },
  ]}
/>

---

# Did anyone else notice in the beginning that configuration in 1 file is getting quite lengthy, how can we sort this out?

---

# Configuration splitting
* DRY (Don't Repeat Yourself)
* webpack-merge
* Let's check 2 examples (here and in project)

---

export default Code;

```javascript EXAMPLE: webpack-merge
const merge = require('webpack-merge');

merge( { a: [1], b: 5, c: 20, e: {i: 25} }, { a: [2], b: 10, d: 421, e: {j: 28} } );
```

---

<CodeSurfer
  title="Loading files"
  code={require("!raw-loader!./webpack-snippets/08-splitting-chunks.js")}
  showNumbers
    steps={[
    { notes: 'Let\'s add a few new common parts for adding with webpack-merge ...' },
    { range: [1, 14], notes: 'First let\'s add splitting chunks.' },
    { range: [16, 25], notes: 'And then we can define entry points and output to test this out :)' },
    { lines: [31], notes: 'And in HTML Webpack Plugin we can define which chunks should be used' },
  ]}
/>

---